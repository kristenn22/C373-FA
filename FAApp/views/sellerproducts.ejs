<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Products - LegitLah</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f6f7fb;
            color: #111;
        }
        .header {
            background: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #000;
            text-decoration: none;
        }
        .nav-links { display: flex; gap: 24px; align-items: center; }
        .nav-link { color: #666; text-decoration: none; font-size: 14px; transition: color 0.3s; cursor: pointer; }
        .nav-link:hover { color: #000; }
        .nav-link.active { color: #000; font-weight: 600; border-bottom: 2px solid #000; padding-bottom: 5px; }
        .container {
            max-width: 1100px;
            margin: 40px auto;
            background: #fff;
            border-radius: 12px;
            padding: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        h1 { margin: 0 0 12px; font-size: 26px; }
        p.lead { margin: 0 0 20px; color: #444; }
        .muted { color: #777; font-size: 14px; }
        .btn-row { display: flex; gap: 10px; margin: 16px 0; flex-wrap: wrap; }
        .btn { padding: 10px 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #000; color: #fff; }
        .btn-primary:hover { background: #222; }
        .btn-secondary { background: #e5e7eb; color: #111; }
        .info-box { padding: 12px; background: #eef2ff; border: 1px solid #c7d2fe; border-radius: 10px; margin-top: 12px; }
        .empty { text-align: center; padding: 32px; color: #888; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 18px; margin-top: 20px; }
        .card { border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .card img { width: 100%; height: 190px; object-fit: cover; background: #f0f0f0; }
        .card-body { padding: 14px; display: flex; flex-direction: column; gap: 6px; }
        .card-title { font-weight: 700; font-size: 16px; }
        .card-price { font-weight: 700; font-size: 18px; }
        .card-meta { color: #666; font-size: 13px; }
    </style>
</head>
<body>
    <div class="header">
        <a href="/admin" class="logo">LegitLah</a>
        <nav class="nav-links">
            <a href="/seller" class="nav-link">Manage Orders</a>
            <a href="/sellerorders" class="nav-link">View All Orders</a>
            <a href="/sellerproducts" class="nav-link active">My Products</a>
            <a href="/login" class="nav-link">Seller Login</a>
            <a href="#" onclick="logout()" class="nav-link">Logout</a>
        </nav>
    </div>

    <div class="container">
        <h1>My Products</h1>
        <p class="lead">View the products you listed as a seller.</p>

        <div class="info-box">
            <div><strong>Seller Contract:</strong> <span id="sellerContract"><%= sellerContractAddress %></span></div>
            <div class="muted">Connect your wallet to load your products.</div>
        </div>

        <div class="btn-row">
            <button class="btn btn-primary" onclick="connectWallet()">Connect Wallet</button>
            <button class="btn btn-secondary" onclick="refreshProducts()">Refresh</button>
            <button class="btn btn-secondary" onclick="goManageOrders()">Go to Manage Orders</button>
        </div>

        <div id="productsGrid" class="grid" style="display:none;"></div>
        <div id="emptyState" class="empty">Connect your wallet to load your products.</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        let web3;
        let sellerContract;
        let userAccount;
        const sellerContractABI = <%- sellerContractABI %>;
        const sellerContractData = <%- sellerContractData %>;

        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    alert('Please install MetaMask to continue.');
                    return;
                }
                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accounts[0];

                const networkId = await web3.eth.net.getId();
                const deployed = sellerContractData.networks[networkId];
                if (!deployed) {
                    alert('Seller contract not deployed on this network');
                    return;
                }
                sellerContract = new web3.eth.Contract(sellerContractABI, deployed.address);

                document.getElementById('emptyState').textContent = 'Loading your products...';
                await refreshProducts();
            } catch (err) {
                console.error(err);
                alert('Wallet connection failed.');
            }
        }

        const buyerProducts = [
            { name: 'One Piece The Monsters', price: '$150', image: '/images/onepiece.jpg', listed: 'Listed 1 week ago' },
            { name: 'Gaming Headset Pro', price: '$85', image: 'https://via.placeholder.com/300x300?text=Gaming+Headset', listed: 'Listed 3 days ago' },
            { name: 'Blue Sneakers', price: '$120', image: 'https://via.placeholder.com/300x300?text=Sneakers', listed: 'Listed 5 days ago' }
        ];

        async function refreshProducts() {
            if (!sellerContract || !userAccount) {
                document.getElementById('emptyState').textContent = 'Connect your wallet to load your products.';
                document.getElementById('productsGrid').style.display = 'none';
                return;
            }

            try {
                renderProducts(buyerProducts);
            } catch (err) {
                console.error('Failed to load products', err);
                document.getElementById('emptyState').textContent = 'Failed to load products.';
                document.getElementById('productsGrid').style.display = 'none';
            }
        }

        function renderProducts(list) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            if (!list || list.length === 0) {
                grid.style.display = 'none';
                document.getElementById('emptyState').textContent = 'No products found for this seller.';
                return;
            }

            list.forEach(p => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <img src="${p.image}" alt="${p.name}" onerror="this.src='https://via.placeholder.com/300x190?text=Product'">
                    <div class="card-body">
                        <div class="card-title">${p.name}</div>
                        <div class="card-price">${p.price}</div>
                        <div class="card-meta">${p.listed}</div>
                    </div>
                `;
                grid.appendChild(card);
            });

            grid.style.display = 'grid';
            document.getElementById('emptyState').textContent = '';
        }

        function goManageOrders() {
            window.location.href = '/seller';
        }

        function logout() {
            fetch('/logout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(r => r.json())
            .then(d => { if (d.success) window.location.href = '/'; })
            .catch(err => console.error(err));
        }
    </script>
</body>
</html>
