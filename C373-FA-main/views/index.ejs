<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegitLah - Buy and Sell with Ease</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <% 
    function timeAgo(date) {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        if (diffInSeconds < 60) return 'Just now';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 86400)} days ago`;
        return `${Math.floor(diffInSeconds / 604800)} weeks ago`;
    }
    %>
    <!-- Navbar -->
    <nav class="navbar">
        <!-- Row 1: Logo, Search, Dropdown + Button -->
        <div class="navbar-row navbar-top">
            <div class="navbar-left">
                <div class="logo">
                    <h1>LegitLah</h1>
                </div>
            </div>
            <div class="navbar-center">
                <div class="search-bar">
                    <input type="text" id="search" placeholder="Search items..." value="<%= searchQuery %>">
                </div>
            </div>
            <div class="navbar-right">
                <select id="category-filter">
                    <option value="">All Categories</option>
                    <% categories.forEach(cat => { %>
                    <option value="<%= cat %>" <%= selectedCategory === cat ? 'selected' : '' %>><%= cat %></option>
                    <% }); %>
                </select>
                <button class="btn btn-black" id="connect-wallet">Connect Wallet</button>
            </div>
        </div>
        <!-- Row 2: Category Links -->
        <div class="navbar-row navbar-categories">
            <div class="categories-container">
                <a href="/?category=All" class="category-link <%= selectedCategory === 'All' || !selectedCategory ? 'active' : '' %>" data-category="All">All</a>
                <% categories.forEach(cat => { %>
                <a href="/?category=<%= encodeURIComponent(cat) %>" class="category-link <%= selectedCategory === cat ? 'active' : '' %>" data-category="<%= cat %>"><%= cat %></a>
                <% }); %>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h2>Buy and sell with ease</h2>
            <p>with protected payments and verified seller reputation.</p>
            <div class="hero-buttons">
                <button class="btn btn-black" id="hero-connect-wallet">Connect Wallet</button>
                <button class="btn btn-outline">Sign Up</button>
            </div>
        </div>
    </section>

    <!-- Trending Now Section -->
    <section class="trending">
        <div class="container">
            <h3>Trending Now</h3>
            <div class="products-grid" id="products-grid">
                <% products.forEach(product => { %>
                <a href="/product/<%= product.id %>" class="product-card-link">
                    <div class="product-card" data-category="<%= product.category %>">
                        <img src="<%= product.imageUrl %>" alt="<%= product.title %>" class="product-image">
                        <div class="product-info">
                            <div class="product-title"><%= product.title %></div>
                            <div class="product-price">$<%= product.price %></div>
                            <div class="product-category"><%= product.category %></div>
                            <div class="product-meta">
                                <span><%= product.postedBy %></span>
                                <span><%= timeAgo(new Date(product.createdAt)) %></span>
                            </div>
                        </div>
                    </div>
                </a>
                <% }); %>
            </div>
        </div>
    </section>

    <!-- Add Listing Button (fixed) -->
    <a href="/add" class="add-listing-btn">+</a>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <span>LegitLah</span>
                <a href="#">Learn more</a>
            </div>
        </div>
    </footer>

    <script src="/app.js"></script>
</body>
</html>