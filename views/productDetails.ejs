<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.title %> - LegitLah</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <%
    function timeAgo(date) {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        if (diffInSeconds < 60) return 'Just now';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 86400)} days ago`;
        return `${Math.floor(diffInSeconds / 604800)} weeks ago`;
    }
    %>
    <!-- Navbar -->
    <nav class="navbar">
        <!-- Row 1: Logo, Search, Dropdown + Button -->
        <div class="navbar-row navbar-top">
            <div class="navbar-left">
                <div class="logo">
                    <a href="/" style="text-decoration: none; color: inherit;"><h1>LegitLah</h1></a>
                </div>
            </div>
            <div class="navbar-center">
                <div class="search-bar">
                    <input type="text" id="search" placeholder="Search items..." value="">
                </div>
            </div>
            <div class="navbar-right">
                <select id="category-filter">
                    <option value="">All Categories</option>
                    <% categories.forEach(cat => { %>
                    <option value="<%= cat %>"><%= cat %></option>
                    <% }); %>
                </select>
                <button class="btn btn-black" id="connect-wallet">Connect Wallet</button>
            </div>
        </div>
        <!-- Row 2: Category Links -->
        <div class="navbar-row navbar-categories">
            <div class="categories-container">
                <a href="/?category=All" class="category-link">All</a>
                <% categories.forEach(cat => { %>
                <a href="/?category=<%= encodeURIComponent(cat) %>" class="category-link"><%= cat %></a>
                <% }); %>
            </div>
        </div>
    </nav>

    <!-- Product Details Section -->
    <section class="product-details">
        <div class="container">
            <div class="product-details-content">
                <div class="product-image-large">
                    <img src="<%= product.imageUrl %>" alt="<%= product.title %>">
                </div>
                <div class="product-details-info">
                    <h1 class="product-title"><%= product.title %></h1>
                    <div class="product-price">$<%= product.price %></div>
                    <div class="product-meta">
                        <span>Listed by <%= product.postedBy %></span>
                        <span><%= timeAgo(new Date(product.createdAt)) %></span>
                    </div>
                    <div class="product-actions">
                        <button id="buy-btn" class="btn btn-black" onclick="handleBuy('<%= product.title %>', <%= product.price %>)">Buy</button>
                        <a href="/chat/<%= encodeURIComponent(product.postedBy) %>?productId=<%= product.id %>" class="btn btn-outline">Chat</a>
                    </div>
                    <% if (success) { %>
                    <div id="success-message" class="success-message">✅ Purchase request sent to seller!</div>
                    <% } %>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <span>LegitLah</span>
                <a href="#">Learn more</a>
            </div>
        </div>
    </footer>

    <script>
        function handleBuy(title, price) {
            const confirmed = confirm(`Confirm purchase of ${title} for $${price}?`);
            if (confirmed) {
                // Show success message
                const messageDiv = document.getElementById('success-message') || document.createElement('div');
                messageDiv.id = 'success-message';
                messageDiv.className = 'success-message';
                messageDiv.textContent = '✅ Purchase request sent to seller!';
                document.querySelector('.product-actions').appendChild(messageDiv);

                // Disable button
                document.getElementById('buy-btn').disabled = true;
                document.getElementById('buy-btn').textContent = 'Purchased';
            }
        }
    </script>
    <script src="/app.js"></script>
</body>
</html>